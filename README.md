# üéØ Tiroir Motoris√© Intelligent ‚Äî Tutoriel Complet
## Projet ESP32 + TMC2209 + Home Assistant

> üìÖ **D√©marr√© :** Octobre 2025  
> ‚úÖ **Statut :** Phase 2 en cours ‚Äî Syst√®me motoris√© op√©rationnel  
> üéì **Niveau :** Interm√©diaire (√©lectronique + domotique)

---

## üìñ Table des mati√®res

1. [Pr√©sentation du projet](#-pr√©sentation-du-projet)
2. [Ce que tu vas construire](#-ce-que-tu-vas-construire)
3. [Mat√©riel n√©cessaire](#-mat√©riel-n√©cessaire)
4. [Guide de construction](#-guide-de-construction-√©tape-par-√©tape)
5. [Configuration logicielle](#-configuration-logicielle)
6. [Utilisation quotidienne](#-utilisation-quotidienne)
7. [Automatisations avanc√©es](#-automatisations-avanc√©es)
8. [D√©pannage](#-d√©pannage)

---

## üé¨ Pr√©sentation du projet

### **Le probl√®me**
Tu travailles sur un bureau et tu veux :
- Ranger ton clavier/souris quand tu ne travailles pas (bureau propre)
- Les d√©ployer rapidement quand tu t'assois
- **Sans** avoir √† les manipuler manuellement √† chaque fois

### **La solution**
Un **tiroir motoris√© silencieux** qui :
- S'ouvre/ferme en **10 secondes** (vitesse r√©glable)
- Est **100% silencieux** (technologie TMC2209 StealthChop)
- Se pilote via **Home Assistant** (smartphone, automatisations, vocal)
- A des **boutons physiques LED** pour contr√¥le manuel
- D√©tecte les **blocages** et s'arr√™te automatiquement (s√©curit√©)

---

## üé® Ce que tu vas construire

### **Vue d'ensemble du syst√®me**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            BUREAU (vue de dessous)              ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  [Moteur NEMA17] ‚îÄ‚îÄ‚Üí Courroie GT2      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ         ‚Üì                    ‚Üì          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    [Poulie 20T]          [Poulie]      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  TIROIR (rails t√©lescopiques)  ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  [Clavier] [Souris]            ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  [Bo√Ætier √©lectronique]  [3 Boutons LED]       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Composants √©lectroniques**

```
         Home Assistant
              ‚Üï WiFi
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ  ESP32  ‚îÇ ‚Üê Cerveau du syst√®me
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ         ‚îÇ         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ TMC  ‚îÇ  ‚îÇINA219‚îÇ  ‚îÇ Boutons ‚îÇ
‚îÇ 2209 ‚îÇ  ‚îÇ I¬≤C  ‚îÇ  ‚îÇ   LED   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ NEMA 17  ‚îÇ ‚Üê Moteur silencieux
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß∞ Mat√©riel n√©cessaire

### **üîß Composants √©lectroniques**

| Pi√®ce | Quantit√© | Prix unitaire | Lien |
|-------|----------|---------------|------|
| **ESP32 DevKit V4** | 1 | ~7‚Ç¨ | [AliExpress](https://fr.aliexpress.com/item/1005006212080137.html) |
| **Moteur NEMA 17** | 1 | ~10‚Ç¨ | [AliExpress](https://fr.aliexpress.com/item/32665922113.html) |
| **Driver TMC2209 V2** | 1 | ~8‚Ç¨ | [AliExpress](https://fr.aliexpress.com/item/1005004063785803.html) |
| **Module INA219** | 1 | ~2‚Ç¨ | [AliExpress](https://fr.aliexpress.com/item/1005007533576335.html) |
| **Alimentation 24V 3A** | 1 | ~12‚Ç¨ | [AliExpress](https://fr.aliexpress.com/item/1005007087317638.html) |
| **Buck Converter LM2596** | 1 | ~2‚Ç¨ | [AliExpress](https://fr.aliexpress.com/item/1005006149348817.html) |
| **Boutons LED 12mm (x3)** | 1 lot | ~5‚Ç¨ | [AliExpress](https://fr.aliexpress.com/item/1005003575736338.html) |
| **R√©sistances 220Œ©** | 3 | ~1‚Ç¨ | [AliExpress](https://fr.aliexpress.com/item/1005008902058496.html) |
| **Capteurs TCRT5000** | 2 | ~3‚Ç¨ | [AliExpress](https://fr.aliexpress.com/item/1899471977.html) |

**Total √©lectronique :** ~50‚Ç¨

### **üî© Composants m√©caniques**

| Pi√®ce | Quantit√© | Prix unitaire | Lien |
|-------|----------|---------------|------|
| **Kit courroie GT2 + poulies 20T** | 1 | ~8‚Ç¨ | [AliExpress](https://fr.aliexpress.com/item/32303569726.html) |
| **Rails t√©lescopiques 400mm** | 1 paire | ~15‚Ç¨ | [AliExpress](https://fr.aliexpress.com/item/1005002992085234.html) |
| **C√¢bles Dupont** | 1 lot | ~3‚Ç¨ | Recherche "Lot 120 c√¢bles Dupont" |
| **Visserie M3/M4** | 1 kit | ~5‚Ç¨ | Recherche "Kit visserie makers" |

**Total m√©canique :** ~30‚Ç¨

### **üõ†Ô∏è Outils n√©cessaires**

- ‚úÖ Multim√®tre digital (v√©rifier tensions)
- ‚úÖ Tournevis cruciforme (r√©glage potentiom√®tres)
- ‚úÖ Pince coupante + d√©nude-fil
- ‚úÖ Fer √† souder (optionnel mais recommand√©)
- ‚úÖ Ordinateur avec port USB (flashage ESP32)

---

## üèóÔ∏è Guide de construction (√©tape par √©tape)

### **üìÖ Phase 1 : C√¢blage √©lectronique (2-3h)**

#### **√âtape 1.1 : Pr√©paration**
```
‚úì Pose tous les composants sur une table propre
‚úì Identifie chaque composant avec son nom
‚úì Pr√©pare un espace de travail √©clair√©
‚úì Lis le document Branchement.md en entier
```

#### **√âtape 1.2 : R√©glages pr√©liminaires CRITIQUES**

> ‚ö†Ô∏è **CES R√âGLAGES SONT OBLIGATOIRES** ‚Äî Ne pas les faire = risque de destruction

**A. R√©glage Buck Converter (24V ‚Üí 5V)**
```
1. Branche UNIQUEMENT alim 24V sur Buck Converter
2. Mesure tension sortie avec multim√®tre
3. Tourne potentiom√®tre pour obtenir exactement 5.0V
4. D√©branche TOUT
```
‚û°Ô∏è [Voir proc√©dure d√©taill√©e](./Branchement.md#2Ô∏è‚É£-buck-converter-lm2596-24v--5v)

**B. R√©glage TMC2209 VREF**
```
1. Branche alim 24V sur TMC2209 (SANS moteur)
2. Mesure tension entre potentiom√®tre et GND
3. Ajuste √† 0.55V (pour 1A RMS)
4. D√©branche TOUT
```
‚û°Ô∏è [Voir proc√©dure d√©taill√©e](./Branchement.md#4Ô∏è‚É£-tmc2209-driver-moteur-silencieux)

#### **√âtape 1.3 : C√¢blage alimentation**

Suis l'ordre **EXACT** :

1. **Rail GND commun** (critique pour √©viter les probl√®mes)
   - Utilise un bornier √† vis ou une breadboard
   - Connecte TOUS les GND ensemble
   
2. **Alimentation 24V ‚Üí INA219 ‚Üí TMC2209**
   - INA219 en s√©rie sur ligne +24V
   
3. **Buck Converter ‚Üí ESP32**
   - OUT+ vers VIN ESP32
   - OUT- vers GND commun

‚û°Ô∏è [Voir sch√©ma complet](./Branchement.md#1Ô∏è‚É£-alimentation-24v--distribution)

#### **√âtape 1.4 : C√¢blage signaux de contr√¥le**

Connecte dans cet ordre :

1. **ESP32 ‚Üí TMC2209** (GPIO 14, 12, 13)
2. **ESP32 ‚Üí INA219** (I¬≤C : GPIO 21, 22)
3. **ESP32 ‚Üí Boutons LED** (GPIO 25, 26, 27, 32, 33, 35)

‚û°Ô∏è [Voir tableau de brochage complet](./Branchement.md#3Ô∏è‚É£-esp32-devkit-38-pins)

#### **√âtape 1.5 : Tests de s√©curit√©**

**AVANT de brancher l'alimentation :**
```
‚ñ° V√©rifier continuit√© GND (toutes les masses bipent)
‚ñ° Pas de court-circuit +24V / GND (r√©sistance > 10kŒ©)
‚ñ° Buck r√©gl√© √† 5.0V
‚ñ° TMC VREF = 0.55V
‚ñ° Polarit√© alim correcte (rouge = +, noir = -)
```

‚û°Ô∏è [Checklist compl√®te](./Branchement.md#-checklist-avant-premier-d√©marrage)

---

### **üìÖ Phase 2 : Configuration logicielle (1-2h)**

#### **√âtape 2.1 : Installation ESPHome**

Si tu n'as pas d√©j√† Home Assistant :

**Option A : ESPHome Dashboard (recommand√©)**
```bash
# Sur un Raspberry Pi ou PC Linux
pip3 install esphome
esphome dashboard config/
```

**Option B : Via Home Assistant Add-on**
```
1. Ouvre Home Assistant
2. Settings ‚Üí Add-ons ‚Üí Add-on Store
3. Cherche "ESPHome" ‚Üí Install
4. Start ‚Üí Open Web UI
```

#### **√âtape 2.2 : Cr√©ation du device**

1. Dans ESPHome Dashboard, clique **"New Device"**
2. Nom : `tiroir-clavier`
3. Type : `ESP32`
4. Connecte l'ESP32 en USB
5. Clique **"Install"** ‚Üí S√©lectionne le port USB

#### **√âtape 2.3 : Configuration YAML**

Copie le code du fichier `esp-proto-tiroir.yaml` fourni dans l'artifact.

**Personnalise ces lignes :**
```yaml
substitutions:
  name: "tiroir-clavier"
  static_ip: 192.168.1.xxx  # Ton IP locale

wifi:
  ssid: "TonSSID"
  password: "TonMotDePasse"

api:
  encryption:
    key: "g√©n√®re-une-cl√©-al√©atoire"  # ESPHome g√©n√®re √ßa automatiquement
```

#### **√âtape 2.4 : Premier flash**

```
1. Sauvegarde le fichier YAML
2. Clique "Install" ‚Üí "Plug into this computer"
3. Attends la compilation (~5 min)
4. Flash automatique via USB
5. D√©branche USB, branche alimentation 24V
6. L'ESP32 devrait appara√Ætre dans Home Assistant
```

---

### **üìÖ Phase 3 : Tests fonctionnels (30 min)**

#### **Test 1 : Connexion WiFi**
```
‚úì ESP32 doit appara√Ætre dans ESPHome Dashboard (online)
‚úì Ping 192.168.1.xxx doit r√©pondre
‚úì Logs ESPHome doivent s'afficher
```

#### **Test 2 : Boutons physiques**
```
1. Appuie sur bouton VERT ‚Üí LED doit s'allumer 1s
2. Appuie sur bouton BLEU ‚Üí LED doit s'allumer 1s
3. Appuie sur bouton ROUGE ‚Üí LED doit s'allumer 1s
4. V√©rifie dans les logs : "Bouton Ouvrir: ON"
```

#### **Test 3 : Moteur (√Ä VIDE)**
```
‚ö†Ô∏è IMPORTANT : Moteur NON connect√© au tiroir
1. Dans Home Assistant ‚Üí Cover "Tiroir Clavier"
2. Clique "Ouvrir" ‚Üí Moteur doit tourner silencieusement
3. Clique "Stop" ‚Üí Arr√™t imm√©diat
4. Clique "Fermer" ‚Üí Rotation inverse
```

#### **Test 4 : Protection surintensit√©**
```
1. Bloque manuellement le moteur pendant rotation
2. V√©rifie arr√™t automatique apr√®s 1-2 secondes
3. Logs doivent afficher "Surintensit√© d√©tect√©e: X.XX A"
```

---

### **üìÖ Phase 4 : Installation m√©canique (2-3h)**

#### **√âtape 4.1 : Montage rails t√©lescopiques**
```
1. Fixe la partie fixe sous le bureau (vis M4)
2. Fixe la partie mobile sous le plateau tiroir
3. Teste la glisse manuellement (doit √™tre fluide)
```

#### **√âtape 4.2 : Installation courroie + poulies**
```
1. Fixe poulie motrice sur axe NEMA 17 (vis de serrage)
2. Positionne poulie folle √† l'autre extr√©mit√©
3. Tends la courroie GT2 (doit "claquer" comme une corde de guitare)
4. Fixe courroie sur le plateau tiroir (collage + vis)
```

#### **√âtape 4.3 : Positionnement capteurs fins de course**
```
1. Colle cibles blanches (carton 2√ó2cm) sur le tiroir
   - Position ferm√©e : d√©but de course
   - Position ouverte : fin de course
2. Fixe capteurs TCRT5000 en face des cibles
3. Ajuste distance capteur/cible √† 5-8mm
4. R√®gle potentiom√®tres (LED s'allume quand cible proche)
```

#### **√âtape 4.4 : Calibration finale**
```
1. Ferme compl√®tement le tiroir manuellement
2. Dans Home Assistant, clique "Reset Position"
3. Ouvre via bouton ‚Üí Note le nombre de pas dans les logs
4. Mets √† jour steps_per_100percent dans le code
5. Reflash l'ESP32
6. Teste ouverture/fermeture compl√®te
```

---

## üíª Configuration logicielle

### **Entit√©s disponibles dans Home Assistant**

Une fois flash√©, tu verras ces entit√©s :

| Type | Nom | Fonction |
|------|-----|----------|
| ü™ü **Cover** | `cover.tiroir_clavier` | Contr√¥le position 0-100% |
| üü¢ **Switch** | `switch.led_verte` | Allume/√©teint LED verte |
| üîµ **Switch** | `switch.led_bleue` | Allume/√©teint LED bleue |
| üî¥ **Switch** | `switch.led_rouge` | Allume/√©teint LED rouge |
| üí° **Switch** | `switch.feedback_led_boutons` | Active/d√©sactive feedback tactile |
| ‚ö° **Sensor** | `sensor.tiroir_ina219_courant` | Courant moteur en temps r√©el |
| üìä **Sensor** | `sensor.tiroir_ina219_puissance` | Puissance consomm√©e |
| üîã **Sensor** | `sensor.tiroir_ina219_tension` | Tension bus 24V |

### **Contr√¥le via l'interface**

```yaml
# Carte Lovelace simple
type: entities
title: Tiroir Clavier
entities:
  - entity: cover.tiroir_clavier
    name: Position
  - type: divider
  - entity: switch.led_verte
    name: üü¢ LED Verte
  - entity: switch.led_bleue
    name: üîµ LED Bleue
  - entity: switch.led_rouge
    name: üî¥ LED Rouge
  - type: divider
  - entity: switch.feedback_led_boutons
    name: üí° Feedback tactile
  - type: divider
  - entity: sensor.tiroir_ina219_courant
    name: Courant moteur
```

---

## üéÆ Utilisation quotidienne

### **Contr√¥le manuel (boutons physiques)**

| Bouton | Action | LED |
|--------|--------|-----|
| üü¢ **VERT** | D√©ployer le tiroir | Clignote 1s |
| üîµ **BLEU** | Rentrer le tiroir | Clignote 1s |
| üî¥ **ROUGE** | Arr√™t d'urgence | Clignote 1s |

### **Contr√¥le via Home Assistant**

**Smartphone / Tablette**
```
1. Ouvre l'app Home Assistant
2. Cherche "Tiroir Clavier"
3. Slide pour ajuster position (0-100%)
4. Ou tape sur OPEN/CLOSE/STOP
```

**Contr√¥le vocal (si configur√©)**
```
"Hey Google, ouvre le tiroir clavier"
"Alexa, ferme le tiroir du bureau"
"Siri, arr√™te le tiroir"
```

---

## ü§ñ Automatisations avanc√©es

### **Auto 1 : Ouverture automatique (capteur de pr√©sence)**

```yaml
automation:
  - alias: "D√©ployer tiroir si je m'assois"
    trigger:
      - platform: state
        entity_id: binary_sensor.chaise_occupee
        to: 'on'
        for: '00:00:05'  # D√©lai 5s pour √©viter faux positifs
    condition:
      - condition: state
        entity_id: cover.tiroir_clavier
        state: 'closed'
      - condition: time
        after: '08:00:00'
        before: '20:00:00'  # Seulement en journ√©e
    action:
      - service: cover.open_cover
        entity_id: cover.tiroir_clavier
```

### **Auto 2 : Fermeture nocturne (20h)**

```yaml
automation:
  - alias: "Ranger tiroir le soir"
    trigger:
      - platform: time
        at: "20:00:00"
    condition:
      - condition: state
        entity_id: cover.tiroir_clavier
        state: 'open'
    action:
      - service: cover.close_cover
        entity_id: cover.tiroir_clavier
      - service: notify.mobile_app
        data:
          message: "üåô Tiroir rang√© pour la nuit"
```

### **Auto 3 : Mode nuit LED (d√©sactivation automatique)**

```yaml
automation:
  - alias: "√âteindre LED boutons la nuit"
    trigger:
      - platform: time
        at: "22:00:00"
    action:
      - service: switch.turn_off
        entity_id:
          - switch.led_verte
          - switch.led_bleue
          - switch.led_rouge
          - switch.feedback_led_boutons
  
  - alias: "Rallumer LED boutons le matin"
    trigger:
      - platform: time
        at: "08:00:00"
    action:
      - service: switch.turn_on
        entity_id: switch.feedback_led_boutons
```

### **Auto 4 : Alerte surintensit√© (blocage d√©tect√©)**

```yaml
automation:
  - alias: "Alerte blocage tiroir"
    trigger:
      - platform: numeric_state
        entity_id: sensor.tiroir_ina219_courant
        above: 1.5
        for: '00:00:02'
    action:
      - service: cover.stop_cover
        entity_id: cover.tiroir_clavier
      - service: switch.turn_on
        entity_id: switch.led_rouge
      - service: notify.mobile_app
        data:
          message: "‚ö†Ô∏è Tiroir bloqu√© ! Courant anormal : {{ states('sensor.tiroir_ina219_courant') }}A"
          title: "Alerte Tiroir"
```

---

## üîß D√©pannage

### **Probl√®me 1 : ESP32 ne se connecte pas au WiFi**

**Sympt√¥mes :** LED bleue clignote rapidement, pas d'apparition dans Home Assistant

**Solutions :**
```
‚úì V√©rifie SSID/password dans le code (sensible √† la casse)
‚úì Assure-toi que le WiFi est en 2.4GHz (ESP32 ne supporte pas 5GHz)
‚úì Rapproche l'ESP32 du routeur lors du premier d√©marrage
‚úì Regarde les logs via USB : esphome logs tiroir-clavier.yaml
```

### **Probl√®me 2 : Moteur ne tourne pas**

**Sympt√¥mes :** Commande envoy√©e mais pas de mouvement

**Solutions :**
```
‚úì V√©rifie GPIO 13 (EN) ‚Üí doit √™tre LOW pour activer
‚úì V√©rifie connexion VIO (3.3V) sur TMC2209
‚úì Mesure VREF (doit √™tre 0.55V)
‚úì Teste avec "Test Rotation Horaire" dans ESPHome
‚úì V√©rifie que les 4 fils moteur sont bien connect√©s
```

### **Probl√®me 3 : Mouvement saccad√© / bruyant**

**Sympt√¥mes :** Moteur fait du bruit, vibrations

**Solutions :**
```
‚úì R√©duis vitesse : max_speed: 600 steps/s
‚úì Augmente acc√©l√©ration douce : acceleration: 300 steps/s¬≤
‚úì V√©rifie tension courroie (doit √™tre bien tendue)
‚úì V√©rifie dissipateur thermique sur TMC2209
‚úì R√©duis VREF si surchauffe (essaie 0.50V)
```

### **Probl√®me 4 : LED boutons ne s'allument pas**

**Sympt√¥mes :** Boutons fonctionnent mais pas de feedback visuel

**Solutions :**
```
‚úì V√©rifie polarit√© LED (broche 2 = +, broche 3 = -)
‚úì V√©rifie r√©sistances 220Œ© pr√©sentes
‚úì Teste LED directement : 3.3V ‚Üí R 220Œ© ‚Üí LED+ ‚Üí LED- ‚Üí GND
‚úì V√©rifie que switch.feedback_led_boutons = ON
```

### **Probl√®me 5 : Arr√™ts intempestifs**

**Sympt√¥mes :** Tiroir s'arr√™te au milieu de la course

**Solutions :**
```
‚úì V√©rifie INA219 courant (doit √™tre < 1.5A)
‚úì Augmente seuil surintensit√© dans le code (essaie 2.0A)
‚úì V√©rifie alimentation 24V 3A (pas de chute de tension)
‚úì R√©duis charge sur le tiroir (poids clavier + souris)
```

---

## üìä Monitoring & Maintenance

### **Surveillance recommand√©e**

Ajoute ces sensors dans Home Assistant :

```yaml
sensor:
  - platform: history_stats
    name: "Utilisations tiroir aujourd'hui"
    entity_id: cover.tiroir_clavier
    state: 'opening'
    type: count
    start: '{{ now().replace(hour=0, minute=0, second=0) }}'
    end: '{{ now() }}'

  - platform: statistics
    name: "Courant moteur moyen"
    entity_id: sensor.tiroir_ina219_courant
    state_characteristic: mean
    max_age:
      hours: 24
```

### **Maintenance p√©riodique**

**Mensuelle :**
- [ ] V√©rifier tension courroie
- [ ] Nettoyer capteurs TCRT5000 (poussi√®re)
- [ ] V√©rifier temp√©rature TMC2209 (doit rester ti√®de)

**Trimestrielle :**
- [ ] Lubrifier rails t√©lescopiques (graisse silicone)
- [ ] V√©rifier serrages vis moteur
- [ ] Tester protection surintensit√© (bloquer manuellement)

**Annuelle :**
- [ ] Remplacer courroie GT2 si usure visible
- [ ] Nettoyer compl√®tement le syst√®me
- [ ] V√©rifier toutes les connexions √©lectriques

---

## üìö Ressources compl√©mentaires

### **Documentation technique**
- üìÑ [Branchement.md](./Branchement.md) ‚Äî Sch√©mas √©lectriques d√©taill√©s
- üìÑ [esp-proto-tiroir.yaml](./esp-proto-tiroir.yaml) ‚Äî Code ESPHome complet
- üîó [Documentation ESPHome](https://esphome.io/)
- üîó [TMC2209 Datasheet](https://www.trinamic.com/products/integrated-circuits/details/tmc2209-la/)

### **Communaut√© & Support**
- üí¨ Forum Home Assistant : [community.home-assistant.io](https://community.home-assistant.io/)
- üí¨ Reddit : r/homeassistant
- üí¨ Discord ESPHome : [discord.gg/KhAMKrd](https://discord.gg/KhAMKrd)

---

## üéâ F√©licitations !

Si tu es arriv√© jusqu'ici, tu as maintenant un **tiroir motoris√© intelligent** compl√®tement fonctionnel ! üöÄ

### **Am√©liorations possibles :**
- ‚ú® Ajout d'un capteur de poids (d√©tecter pr√©sence clavier)
- ‚ú® LED RGB sous le tiroir (effet lumineux)
- ‚ú® Int√©gration Matter/Thread (futur-proof)
- ‚ú® Deuxi√®me tiroir synchronis√© (gauche + droite)

**Partage ton projet !** N'h√©site pas √† poster des photos de ta r√©alisation. üì∏

---

> üìÖ **Derni√®re mise √† jour :** Octobre 2025  
> ‚úçÔ∏è **Version :** 2.0  
> üìß **Questions ?** Consulte la section [D√©pannage](#-d√©pannage)
